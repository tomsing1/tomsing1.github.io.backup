# `vtree`: Visualizing nested relationships

Today I learned about the [vtree](https://cran.r-project.org/web/packages/vtree/index.html) R package, 
which displays information about nested subsets of a data frame.

Here are some examples using the `Titanic` dataset that ships with R:

```r
library(vtree)
library(dplyr)

class(Titanic)  # array with counts
titanic <- crosstabToCases(Titanic)
```

We start with a data.frame that has one row for each observation, and provides
information about the *variables* in separate columns.

```r
head(titanic)  # data.frame with individual outcomes
```

For example, the `titanic` data.frame holds 2201 rows, one for each passenger,
and lists each subject ticket `Class`, their `Sex` and `Age` and whether they
survived the shipwreck:

```
  Class  Sex   Age Survived
1   3rd Male Child       No
2   3rd Male Child       No
3   3rd Male Child       No
4   3rd Male Child       No
5   3rd Male Child       No
6   3rd Male Child       No
```

Enter `vtree`: a single command displays the nested relationship encoded in the
table:

```r
titanic %>%
  vtree("Class Sex Age", summary="Survived=Yes \n%pct% survived")
```

The [vtree vignette]() is incredibly detailed and highlights how to control
almost every aspect of the tree, including the summary statistics shown for
each node, the display options, colors, selection of nodes to include / exclude,
etc.

```r
# create a vertical layout instead
titanic %>%
  vtree("Class Sex Age", summary="Survived=Yes \n%pct% survived", horiz = FALSE)

# get the same information as a table
titanic %>%
  vtree("Class Sex Age", summary="Survived=Yes \n%pct% survived",
        ptable = TRUE)

# draw a `pattern tree`, separately displaying the paths to the leaves
titanic %>%
  vtree("Class Sex Age", summary="Survived=Yes \n%pct% survived",
        pattern = TRUE, showroot = TRUE, seq = TRUE)

# exclude any group with < 10 counts
titanic %>%
  vtree("Class Sex Age", summary="Survived=Yes \n%pct% survived",
        prunesmaller = 20)

# omit counts downstream of the `Crew` class
titanic %>%
  vtree("Class Sex Age", summary="Survived=Yes \n%pct% survived",
        prunebelow = list(Class="Crew"))

# add custom text to one or more nodes
titanic %>%
  vtree("Class Sex Age", showvarnames = FALSE, 
        text = list(Class=c(Crew="\n*Did all the work*")))

# change a label
titanic %>%
  vtree("Class Sex Age", summary="Survived=Yes \n%pct% survived",
        labelnode=list(Sex=c("M"="Male","F"="Female")))

# add a legend instead of node labels
titanic %>%
  vtree("Class Sex Age", summary="Survived=Yes \n%pct% survived",
        showlegend = TRUE, shownodelabels = FALSE)

# `sameline=TRUE` displays node labels on the same line as the summary
titanic %>%
  vtree("Class Sex Age", summary="Survived=Yes \n%pct% survived",
        sameline = TRUE)
```
